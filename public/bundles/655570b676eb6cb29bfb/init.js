(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1366:function(e,t,n){"use strict";n.r(t),n.d(t,"rageshakePromise",(function(){return pe})),n.d(t,"preparePlatform",(function(){return ge})),n.d(t,"setupLogStorage",(function(){return me})),n.d(t,"loadConfig",(function(){return we})),n.d(t,"loadOlm",(function(){return be})),n.d(t,"loadLanguage",(function(){return ye})),n.d(t,"loadTheme",(function(){return fe})),n.d(t,"loadApp",(function(){return ve})),n.d(t,"showError",(function(){return Ce})),n.d(t,"showIncompatibleBrowser",(function(){return Se})),n.d(t,"loadModules",(function(){return xe})),n.d(t,"_t",(function(){return J.b}));var a=n(1507),r=n(1508),o=n.n(r),i=n(87),s=n(0),c=n.n(s),l=n(1),d=n(6),u=n(74),h=n(25),p=n(343),g=n(3),m=n(655),w=n(652),b=n.n(w),y=n(1375),f=n(10),v=n(674),C=n(12),S=n(130),x=n(39),O=n(94),k=n(14),E=n(1434),I=n(226),U=n(648),j=n(681);var _=({description:e,acceptLabel:t,dismissLabel:n,onAccept:a,onDismiss:r,toastKey:o,numSeconds:i})=>{const s=()=>{r&&r(),I.a.sharedInstance().dismissToast(o)},l=Object(j.a)(s,1e3,i);let d=n;return l>0&&(d+=` (${l})`),c.a.createElement(U.a,{description:e,acceptLabel:t,onAccept:a,rejectLabel:d,onReject:s})},R=n(1384),P=n(56),D=n(197),N=n(2),A=n.n(N),L=n(13),T=n.n(L),M=n(34),V=n(60),B=n(11),F=n(157);function W(){const e=u.a.get();return e?null==e?void 0:e.getDesktopCapturerSources({thumbnailSize:{height:176,width:312},types:["screen","window"]}):Promise.resolve([])}let K=function(e){return e.Screens="screen",e.Windows="window",e}({});class $ extends c.a.Component{constructor(e){super(e),A()(this,"onClick",(()=>{this.props.onSelect(this.props.source)}))}render(){const e=T()({mx_desktopCapturerSourcePicker_source_thumbnail:!0,mx_desktopCapturerSourcePicker_source_thumbnail_selected:this.props.selected});return c.a.createElement(B.a,{className:"mx_desktopCapturerSourcePicker_source",title:this.props.source.name,onClick:this.onClick},c.a.createElement("img",{alt:this.props.source.name,className:e,src:this.props.source.thumbnailURL}),c.a.createElement("span",{className:"mx_desktopCapturerSourcePicker_source_name"},this.props.source.name))}}class q extends c.a.Component{constructor(e){super(e),A()(this,"interval",void 0),A()(this,"onSelect",(e=>{this.setState({selectedSource:e})})),A()(this,"onShare",(()=>{this.props.onFinished(this.state.selectedSource)})),A()(this,"onTabChange",(()=>{this.setState({selectedSource:void 0})})),A()(this,"onCloseClick",(()=>{this.props.onFinished()})),this.state={selectedTab:K.Screens,sources:[]}}async componentDidMount(){this.setState({sources:await W()}),this.interval=window.setInterval((async()=>{this.setState({sources:await W()})}),500)}componentWillUnmount(){clearInterval(this.interval)}getTab(e,t){const n=this.state.sources.filter((t=>t.id.startsWith(e))).map((e=>{var t;return c.a.createElement($,{selected:(null===(t=this.state.selectedSource)||void 0===t?void 0:t.id)===e.id,source:e,onSelect:this.onSelect,key:e.id})}));return new F.a(e,t,null,c.a.createElement("div",{className:"mx_desktopCapturerSourcePicker_tab"},n))}render(){const e=[this.getTab("screen",Object(l.d)("Share entire screen")),this.getTab("window",Object(l.d)("Application window"))];return c.a.createElement(M.a,{className:"mx_desktopCapturerSourcePicker",onFinished:this.onCloseClick,title:Object(l.b)("Share content")},c.a.createElement(F.c,{tabs:e,tabLocation:F.b.TOP,onChange:this.onTabChange}),c.a.createElement(V.a,{primaryButton:Object(l.b)("action|share"),hasCancel:!0,onCancel:this.onCloseClick,onPrimaryButtonClick:this.onShare,primaryDisabled:!this.state.selectedSource}))}}var H=n(400),G=n(1509),J=n(1367);class z extends y.e{constructor(...e){super(...e),b()(this,"_favicon",void 0)}async getConfig(){return Object(H.a)()}getHumanReadableName(){return"Vector Base Platform"}get favicon(){return this._favicon||(this._favicon=new G.a),this._favicon}updateFavicon(){let e="#d00",t=this.notificationCount;this.errorDidOccur&&(t=t||"×",e="#f00"),this.favicon.badge(t,{bgColor:e})}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),this.updateFavicon())}setErrorStatus(e){this.errorDidOccur!==e&&(super.setErrorStatus(e),this.updateFavicon())}startUpdater(){}getDefaultDeviceDisplayName(){return Object(J.b)("unknown_device")}}class Y{async supportsEventIndexing(){return!0}async initEventIndex(e,t){throw new Error("Unimplemented")}async addEventToIndex(e,t){throw new Error("Unimplemented")}async deleteEvent(e){throw new Error("Unimplemented")}async isEventIndexEmpty(){throw new Error("Unimplemented")}isRoomIndexed(e){throw new Error("Unimplemented")}async getStats(){throw new Error("Unimplemented")}async getUserVersion(){throw new Error("Unimplemented")}async setUserVersion(e){throw new Error("Unimplemented")}async commitLiveEvents(){throw new Error("Unimplemented")}async searchEventIndex(e){throw new Error("Unimplemented")}async addHistoricEvents(e,t,n){throw new Error("Unimplemented")}async addCrawlerCheckpoint(e){throw new Error("Unimplemented")}async removeCrawlerCheckpoint(e){throw new Error("Unimplemented")}async loadCheckpoints(){throw new Error("Unimplemented")}async loadFileEvents(e){throw new Error("Unimplemented")}async closeEventIndex(){throw new Error("Unimplemented")}async deleteEventIndex(){throw new Error("Unimplemented")}}var Q=n(7);class X{constructor(e="ipcCall",t="ipcReply"){if(this.sendChannel=e,this.recvChannel=t,b()(this,"pendingIpcCalls",{}),b()(this,"nextIpcCallId",0),b()(this,"onIpcReply",((e,t)=>{if(void 0===t.id)return void g.a.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[t.id])return void g.a.warn("Unknown IPC payload ID: "+t.id);const n=this.pendingIpcCalls[t.id];delete this.pendingIpcCalls[t.id],t.error?n.reject(t.error):n.resolve(t.reply)})),!window.electron)throw new Error("Cannot instantiate ElectronPlatform, window.electron is not set");window.electron.on(this.recvChannel,this.onIpcReply)}async call(e,...t){const n=++this.nextIpcCallId,a=Object(Q.m)();return this.pendingIpcCalls[n]=a,window.electron.send(this.sendChannel,{id:n,name:e,args:t}),a.promise}}class Z extends Y{constructor(...e){super(...e),b()(this,"ipc",new X("seshat","seshatReply"))}async supportsEventIndexing(){return this.ipc.call("supportsEventIndexing")}async initEventIndex(e,t){return this.ipc.call("initEventIndex",e,t)}async addEventToIndex(e,t){return this.ipc.call("addEventToIndex",e,t)}async deleteEvent(e){return this.ipc.call("deleteEvent",e)}async isEventIndexEmpty(){return this.ipc.call("isEventIndexEmpty")}async isRoomIndexed(e){return this.ipc.call("isRoomIndexed",e)}async commitLiveEvents(){return this.ipc.call("commitLiveEvents")}async searchEventIndex(e){return this.ipc.call("searchEventIndex",e)}async addHistoricEvents(e,t,n){return this.ipc.call("addHistoricEvents",e,t,n)}async addCrawlerCheckpoint(e){return this.ipc.call("addCrawlerCheckpoint",e)}async removeCrawlerCheckpoint(e){return this.ipc.call("removeCrawlerCheckpoint",e)}async loadFileEvents(e){return this.ipc.call("loadFileEvents",e)}async loadCheckpoints(){return this.ipc.call("loadCheckpoints")}async closeEventIndex(){return this.ipc.call("closeEventIndex")}async getStats(){return this.ipc.call("getStats")}async getUserVersion(){return this.ipc.call("getUserVersion")}async setUserVersion(e){return this.ipc.call("setUserVersion",e)}async deleteEventIndex(){return this.ipc.call("deleteEventIndex")}}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const te=navigator.platform.toUpperCase().includes("MAC");function ne(e){["call_state"].includes(e.action)&&window.electron.send("app_onAction",e)}class ae extends z{constructor(){if(super(),b()(this,"ipc",new X("ipcCall","ipcReply")),b()(this,"eventIndexManager",new Z),b()(this,"ssoID",Object(O.b)(32)),b()(this,"onBreadcrumbsUpdate",(()=>{const e=R.a.instance.rooms.slice(0,7).map((e=>({roomId:e.roomId,avatarUrl:Object(D.b)(e,Math.floor(60*window.devicePixelRatio),Math.floor(60*window.devicePixelRatio),"crop"),initial:Object(D.f)(e.name)})));this.ipc.call("breadcrumbs",e)})),b()(this,"onUpdateDownloaded",(async(e,{releaseNotes:t,releaseName:n})=>{f.a.dispatch({action:k.a.CheckUpdates,status:y.d.Ready}),this.shouldShowUpdate(n)&&Object(E.b)(await this.getAppVersion(),n,t)})),!window.electron)throw new Error("Cannot instantiate ElectronPlatform, window.electron is not set");f.a.register(ne),window.electron.on("check_updates",((e,t)=>{f.a.dispatch(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({action:k.a.CheckUpdates},function(e){return!0===e?{status:y.d.Downloading}:!1===e?{status:y.d.NotAvailable}:{status:y.d.Error,detail:e}}(t)))})),window.electron.on("before-quit",(function(){g.a.log("element-desktop closing"),v.b()})),window.electron.on("update-downloaded",this.onUpdateDownloaded),window.electron.on("preferences",(()=>{f.a.fire(k.a.ViewUserSettings)})),window.electron.on("userDownloadCompleted",((e,{id:t,name:n})=>{const a=`DOWNLOAD_TOAST_${t}`;I.a.sharedInstance().addOrReplaceToast({key:a,title:Object(J.b)("download_completed"),props:{description:n,acceptLabel:Object(J.b)("action|open"),onAccept:()=>{window.electron.send("userDownloadAction",{id:t,open:!0}),I.a.sharedInstance().dismissToast(a)},dismissLabel:Object(J.b)("action|dismiss"),onDismiss:()=>{window.electron.send("userDownloadAction",{id:t})},numSeconds:10},component:_,priority:99})})),window.electron.on("openDesktopCapturerSourcePicker",(()=>{const{finished:e}=C.b.createDialog(q);e.then((([e])=>{e&&this.ipc.call("callDisplayMediaCallback",e)}))})),this.ipc.call("startSSOFlow",this.ssoID),R.a.instance.on(P.b,this.onBreadcrumbsUpdate)}async getConfig(){return this.ipc.call("getConfig")}getHumanReadableName(){return"Electron Platform"}supportsSpellCheckSettings(){return!0}allowOverridingNativeContextMenus(){return!0}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),window.electron.send("setBadgeCount",e))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(e,t,n,a,r){navigator.userAgent.includes("Linux")&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const o=super.displayNotification(e,t,n,a,r),i=o.onclick;return o.onclick=()=>{null==i||i(),this.ipc.call("focusWindow")},o}loudNotification(e,t){window.electron.send("loudNotification")}needsUrlTooltips(){return!0}async getAppVersion(){return this.ipc.call("getAppVersion")}supportsSetting(e){switch(e){case"Electron.showTrayIcon":case"Electron.alwaysShowMenuBar":return!te;default:return!0}}getSettingValue(e){return this.ipc.call("getSettingValue",e)}setSettingValue(e,t){return this.ipc.call("setSettingValue",e,t)}async canSelfUpdate(){const e=await this.ipc.call("getUpdateFeedUrl");return Boolean(e)}startUpdateCheck(){super.startUpdateCheck(),window.electron.send("check_updates")}installUpdate(){window.electron.send("install_update")}getDefaultDeviceDisplayName(){const e=h.b.get().brand;return Object(J.b)("desktop_default_device_name",{brand:e,platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload()}getEventIndexingManager(){return this.eventIndexManager}async setLanguage(e){return this.ipc.call("setLanguage",e)}setSpellCheckEnabled(e){this.ipc.call("setSpellCheckEnabled",e).catch((e=>{g.a.log("Failed to send setSpellCheckEnabled IPC to Electron"),g.a.error(e)}))}async getSpellCheckEnabled(){return this.ipc.call("getSpellCheckEnabled")}setSpellCheckLanguages(e){this.ipc.call("setSpellCheckLanguages",e).catch((e=>{g.a.log("Failed to send setSpellCheckLanguages IPC to Electron"),g.a.error(e)}))}async getSpellCheckLanguages(){return this.ipc.call("getSpellCheckLanguages")}async getDesktopCapturerSources(e){return this.ipc.call("getDesktopCapturerSources",e)}supportsDesktopCapturer(){return!0}supportsJitsiScreensharing(){return!1}async getAvailableSpellCheckLanguages(){return this.ipc.call("getAvailableSpellCheckLanguages")}getSSOCallbackUrl(e){const t=super.getSSOCallbackUrl(e);return t.protocol="element",t.searchParams.set("element-desktop-ssoid",this.ssoID),t}startSingleSignOn(e,t,n,a){super.startSingleSignOn(e,t,n,a),C.b.createDialog(S.a,{title:Object(J.b)("auth|sso_complete_in_browser_dialog_title"),description:c.a.createElement(x.a,null)})}navigateForwardBack(e){this.ipc.call(e?"navigateBack":"navigateForward")}overrideBrowserShortcuts(){return!0}async getPickleKey(e,t){try{return await this.ipc.call("getPickleKey",e,t)}catch(e){return null}}async createPickleKey(e,t){try{return await this.ipc.call("createPickleKey",e,t)}catch(e){return null}}async destroyPickleKey(e,t){try{await this.ipc.call("destroyPickleKey",e,t)}catch(e){}}async clearStorage(){try{await super.clearStorage(),await this.ipc.call("clearStorage")}catch(e){}}}var re=n(1510),oe=n.n(re),ie=n(669);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ce(e){return/^v\d+.\d+.\d+(-.+)?$/.test(e)?e.substring(1):e}class le extends z{constructor(){super(),b()(this,"pollForUpdate",((e,t)=>this.getMostRecentVersion().then((n=>{const a=ce(le.VERSION);return a!==n?(this.shouldShowUpdate(n)?(console.log("Update available to "+n+", will notify user"),e(a,n)):console.log("Update available to "+n+" but won't be shown"),{status:y.d.Ready}):(console.log("No update available, already on "+n),null==t||t(),{status:y.d.NotAvailable})}),(e=>(g.a.error("Failed to poll for update",e),{status:y.d.Error,detail:e.message||(e.status?e.status.toString():"Unknown Error")}))))),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(window.Notification)}maySendNotifications(){return"granted"===window.Notification.permission}requestNotificationPermission(){return new Promise((function(e){window.Notification.requestPermission((t=>{e(t)}))}))}async getMostRecentVersion(){const e=await fetch("version",{method:"GET",cache:"no-cache"});if(e.ok){return ce((await e.text()).trim())}return Promise.reject({status:e.status})}getAppVersion(){return Promise.resolve(ce(le.VERSION))}startUpdater(){console.log("startUpdater, current version is "+ce(le.VERSION)),this.pollForUpdate(((e,t)=>{if(Object(ie.a)(location).updated)return console.log("Update reloaded but still on an old version, stopping"),void Object(E.b)(e,t);const n=new URL(window.location.href);n.searchParams.set("updated",t),console.log("Update reloading to "+n.toString()),window.location.href=n.toString()})),setInterval((()=>this.pollForUpdate(E.b,E.a)),6e5)}async canSelfUpdate(){return!0}startUpdateCheck(){super.startUpdateCheck(),this.pollForUpdate(E.b,E.a).then((e=>{f.a.dispatch(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({action:k.a.CheckUpdates},e))}))}installUpdate(){window.location.reload()}getDefaultDeviceDisplayName(){const e=new URL(window.location.href),t=[e.host,e.pathname.replace(/\/$/,"")].join(""),n=new oe.a,a=n.getBrowser().name||"unknown browser";let r=n.getOS().name||"unknown OS";return"Mac OS"===r&&(r="macOS"),Object(J.b)("web_default_device_name",{appName:t,browserName:a,osName:r})}reload(){window.location.reload()}}b()(le,"VERSION","develop");class de extends le{setNotificationCount(e){if(!navigator.setAppBadge)return super.setNotificationCount(e);this.notificationCount!==e&&(this.notificationCount=e,navigator.setAppBadge(e).catch((e=>{g.a.error("Failed to update PWA app badge",e)})))}}var ue=n(396);window.mxSendRageshake=function(e,t){const n=h.b.get().bug_report_endpoint_url;n?(void 0===t&&(t=!0),e&&e.trim()?Object(ue.a)(n,{userText:e,sendLogs:t,progressCallback:g.a.log.bind(console)}).then((()=>{g.a.log("Bug report sent!")}),(e=>{g.a.error(e)})):g.a.error("Cannot send a rageshake without a message - please tell us what went wrong")):g.a.error("Cannot send a rageshake - no bug_report_endpoint_url configured")};const he=[],pe=function(){const e=v.d(!1);return e.then((()=>{g.a.log("Initialised rageshake."),g.a.log("To fix line numbers in Chrome: Meatball menu → Settings → Ignore list → Add /rageshake\\.ts & /logger\\.ts$"),window.addEventListener("beforeunload",(()=>{g.a.log("element-web closing"),v.b()})),v.a()}),(e=>{g.a.error("Failed to initialise rageshake: "+e)})),e}();function ge(){window.electron?(g.a.log("Using Electron platform"),u.a.set(new ae)):window.matchMedia("(display-mode: standalone)").matches?(g.a.log("Using PWA platform"),u.a.set(new de)):(g.a.log("Using Web platform"),u.a.set(new le))}function me(){return h.b.get().bug_report_endpoint_url?v.e():(g.a.warn("No bug report endpoint set - logs will not be persisted"),Promise.resolve())}async function we(){var e;const t=await(null===(e=u.a.get())||void 0===e?void 0:e.getConfig());t?h.b.put(t):h.b.reset()}function be(){return o.a.init({locateFile:()=>a.a}).then((()=>{g.a.log("Using WebAssembly Olm")})).catch((e=>(g.a.log("Failed to load Olm: trying legacy version",e),new Promise(((e,t)=>{const n=document.createElement("script");n.src="olm_legacy.js",n.onload=e,n.onerror=t,document.body.appendChild(n)})).then((()=>window.Olm.init())).then((()=>{g.a.log("Using legacy Olm")})).catch((e=>{g.a.log("Both WebAssembly and asm.js Olm failed!",e)})))))}async function ye(){const e=d.b.getValue("language",null,!0);let t=[];e?t=[e]:l.g().forEach((e=>{t.push(...l.h(e))}));try{await l.l(t),document.documentElement.setAttribute("lang",l.f())}catch(e){g.a.error("Unable to set language",e)}}async function fe(){Object(p.h)()}async function ve(e){const t=await Promise.all([n.e(9),n.e(20),n.e(30),n.e(15)]).then(n.bind(null,1676));window.matrixChat=i.render(await t.loadApp(e),document.getElementById("matrixchat"))}async function Ce(e,t){const a=(await n.e(16).then(n.bind(null,1670))).default;window.matrixChat=i.render(s.createElement(a,{title:e,messages:t}),document.getElementById("matrixchat"))}async function Se(e){const t=(await n.e(14).then(n.bind(null,1671))).default;window.matrixChat=i.render(s.createElement(t,{onAccept:e}),document.getElementById("matrixchat"))}async function xe(){for(const e of he)m.a.instance.registerModule((t=>new e(t)))}},1367:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var a=n(1);class r extends a.a{constructor(e,t){super(e,t)}}function o(e,t,n){return Object(a.b)(e,t,n)}},1375:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"c",(function(){return p})),n.d(t,"b",(function(){return g})),n.d(t,"d",(function(){return m})),n.d(t,"e",(function(){return b}));var a=n(2),r=n.n(a),o=n(26),i=n(3),s=n(10),c=n(14),l=n(1434),d=n(8),u=n(664);const h="mx_sso_hs_url",p="mx_sso_is_url",g="mx_sso_idp_id";let m=function(e){return e.Checking="CHECKING",e.Error="ERROR",e.NotAvailable="NOTAVAILABLE",e.Downloading="DOWNLOADING",e.Ready="READY",e}({});const w="mx_defer_update";class b{constructor(){r()(this,"notificationCount",0),r()(this,"errorDidOccur",!1),r()(this,"onAction",(e=>{switch(e.action){case"on_client_not_viable":case c.a.OnLoggedOut:this.setNotificationCount(0)}})),s.a.register(this.onAction),this.startUpdateCheck=this.startUpdateCheck.bind(this)}setNotificationCount(e){this.notificationCount=e}setErrorStatus(e){this.errorDidOccur=e}async canSelfUpdate(){return!1}startUpdateCheck(){Object(l.a)(),localStorage.removeItem(w),s.a.dispatch({action:c.a.CheckUpdates,status:m.Checking})}installUpdate(){}shouldShowUpdate(e){if(d.a.userRegisteredWithinLastHours(24))return!1;try{const[t,n]=JSON.parse(localStorage.getItem(w));return e!==t||Date.now()>n}catch(e){return!0}}deferUpdate(e){const t=new Date(Date.now()+864e5);t.setHours(8,0,0,0),localStorage.setItem(w,JSON.stringify([e,t.getTime()])),Object(l.a)()}supportsSpellCheckSettings(){return!1}allowOverridingNativeContextMenus(){return!1}supportsNotifications(){return!1}maySendNotifications(){return!1}displayNotification(e,t,n,a,r){const o={body:t,silent:!0};n&&(o.icon=n);const i=new window.Notification(e,o);return i.onclick=()=>{const e={action:c.a.ViewRoom,room_id:a.roomId,metricsTrigger:"Notification"};null!=r&&r.getThread()&&(e.event_id=r.getId()),s.a.dispatch(e),window.focus()},i}loudNotification(e,t){}clearNotification(e){e.close&&e.close()}needsUrlTooltips(){return!1}supportsSetting(e){return!1}async getSettingValue(e){}setSettingValue(e,t){throw new Error("Unimplemented")}getEventIndexingManager(){return null}setLanguage(e){}setSpellCheckEnabled(e){}async getSpellCheckEnabled(){return!1}setSpellCheckLanguages(e){}getSpellCheckLanguages(){return null}async getDesktopCapturerSources(e){return[]}supportsDesktopCapturer(){return!1}supportsJitsiScreensharing(){return!0}overrideBrowserShortcuts(){return!1}navigateForwardBack(e){}getAvailableSpellCheckLanguages(){return null}getSSOCallbackUrl(e=""){const t=new URL(window.location.href);return t.hash=e,t}startSingleSignOn(e,t,n,a,r){localStorage.setItem(h,e.getHomeserverUrl()),e.getIdentityServerUrl()&&localStorage.setItem(p,e.getIdentityServerUrl()),a&&localStorage.setItem(g,a);const o=this.getSSOCallbackUrl(n);window.location.href=e.getSsoLoginUrl(o.toString(),t,a,r)}async getPickleKey(e,t){if(!window.crypto||!window.crypto.subtle)return null;let n;try{n=await Object(u.c)("pickleKey",[e,t])}catch(e){i.a.error("idbLoad for pickleKey failed",e)}if(!n)return null;if(!n.encrypted||!n.iv||!n.cryptoKey)return i.a.error("Badly formatted pickle key"),null;const a=this.getPickleAdditionalData(e,t);try{const e=await crypto.subtle.decrypt({name:"AES-GCM",iv:n.iv,additionalData:a},n.cryptoKey,n.encrypted);return Object(o.encodeUnpaddedBase64)(e)}catch(e){return i.a.error("Error decrypting pickle key"),null}}getPickleAdditionalData(e,t){const n=new Uint8Array(e.length+t.length+1);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);n[e.length]=124;for(let a=0;a<t.length;a++)n[e.length+1+a]=t.charCodeAt(a);return n}async createPickleKey(e,t){if(!window.crypto||!window.crypto.subtle)return null;const n=window.crypto,a=new Uint8Array(32);n.getRandomValues(a);const r=await n.subtle.generateKey({name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),i=new Uint8Array(32);n.getRandomValues(i);const s=this.getPickleAdditionalData(e,t),c=await n.subtle.encrypt({name:"AES-GCM",iv:i,additionalData:s},r,a);try{await Object(u.d)("pickleKey",[e,t],{encrypted:c,iv:i,cryptoKey:r})}catch(e){return null}return Object(o.encodeUnpaddedBase64)(a)}async destroyPickleKey(e,t){try{await Object(u.b)("pickleKey",[e,t])}catch(e){i.a.error("idbDelete failed in destroyPickleKey",e)}}async clearStorage(){window.sessionStorage.clear(),window.localStorage.clear()}}},1384:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a,r=n(2),o=n.n(r),i=n(4),s=n(7),c=n(6),l=n(119),d=n(10),u=n(29),h=n(16),p=n(14);class g extends l.a{constructor(){super(d.a),o()(this,"waitingRooms",[]),o()(this,"onMyMembership",(async e=>{const t=c.b.getValue("breadcrumbs",null,!0);this.meetsRoomRequirement&&Object(s.u)(t)&&await c.b.setValue("breadcrumbs",null,h.a.ACCOUNT,!0)})),o()(this,"onRoom",(async e=>{const t=this.waitingRooms.find((t=>t.roomId===e.roomId));t&&(this.waitingRooms.splice(this.waitingRooms.indexOf(t),1),Date.now()-t.addedTs>9e4||await this.appendRoom(e))})),c.b.monitorSetting("breadcrumb_rooms",null),c.b.monitorSetting("breadcrumbs",null)}static get instance(){return g.internalInstance}get rooms(){return this.state.rooms||[]}get visible(){return!!this.state.enabled&&this.meetsRoomRequirement}get meetsRoomRequirement(){const e=c.b.getValue("feature_dynamic_room_predecessors");return!!this.matrixClient&&this.matrixClient.getVisibleRooms(e).length>=20}async onAction(e){if(this.matrixClient)if(e.action===p.a.SettingUpdated)"breadcrumb_rooms"===e.settingName?await this.updateRooms():"breadcrumbs"===e.settingName&&await this.updateState({enabled:c.b.getValue("breadcrumbs",null)});else if(e.action===p.a.ViewRoom)if(e.auto_join&&e.room_id&&!this.matrixClient.getRoom(e.room_id))this.waitingRooms.push({roomId:e.room_id,addedTs:Date.now()});else{const t=this.matrixClient.getRoom(e.room_id),n=null==t?void 0:t.getMyMembership();t&&"join"===n&&await this.appendRoom(t)}else if(e.action===p.a.JoinRoom){const t=this.matrixClient.getRoom(e.roomId);t&&await this.appendRoom(t)}}async onReady(){await this.updateRooms(),await this.updateState({enabled:c.b.getValue("breadcrumbs",null)}),this.matrixClient&&(this.matrixClient.on(i.RoomEvent.MyMembership,this.onMyMembership),this.matrixClient.on(i.ClientEvent.Room,this.onRoom))}async onNotReady(){this.matrixClient&&(this.matrixClient.removeListener(i.RoomEvent.MyMembership,this.onMyMembership),this.matrixClient.removeListener(i.ClientEvent.Room,this.onRoom))}async updateRooms(){let e=c.b.getValue("breadcrumb_rooms");e&&0!==e.length||(e=[]);const t=Object(u.m)(e.map((e=>{var t;return null===(t=this.matrixClient)||void 0===t?void 0:t.getRoom(e)}))),n=this.state.rooms||[];Object(u.d)(t,n)&&await this.updateState({rooms:t})}async appendRoom(e){var t;let n=!1;const a=(this.state.rooms||[]).slice(),r=c.b.getValue("feature_dynamic_room_predecessors"),o=null===(t=this.matrixClient)||void 0===t?void 0:t.getRoomUpgradeHistory(e.roomId,!1,r);if(o&&o.length>1){e=o[o.length-1];for(let e=0;e<o.length-1;e++){const t=a.findIndex((t=>t.roomId===o[e].roomId));-1!==t&&(a.splice(t,1),n=!0)}}const i=a.findIndex((t=>t.roomId===e.roomId));if(0!==i&&(-1!==i&&a.splice(i,1),a.splice(0,0,e),n=!0),a.length>20&&(a.splice(20,a.length-20),n=!0),n){await this.updateState({rooms:a});const e=a.map((e=>e.roomId));e.length>0&&await c.b.setValue("breadcrumb_rooms",null,h.a.ACCOUNT,e)}}}a=g,o()(g,"internalInstance",(()=>{const e=new a;return e.start(),e})())},1434:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return v}));var a=n(0),r=n.n(a),o=n(1),i=n(25),s=n(648),c=n(226),l=n(77),d=n(39),u=n(161);const h=["vector-im/element-web","matrix-org/matrix-react-sdk","matrix-org/matrix-js-sdk"];class p extends r.a.Component{constructor(e){super(e),this.state={}}async fetchChanges(e,t,n){const a=`https://riot.im/github/repos/${e}/compare/${t}...${n}`;try{const t=await fetch(a);if(!t.ok)return void this.setState({[e]:t.statusText});const n=await t.json();this.setState({[e]:n.commits})}catch(t){this.setState({[e]:t instanceof Error?t.message:Object(o.b)("Unknown error")})}}componentDidMount(){const e=this.props.newVersion.split("-"),t=this.props.version.split("-");if(null!=e&&null!=t)for(let n=0;n<h.length;n++){const a=t[2*n],r=e[2*n];this.fetchChanges(h[n],a,r)}}elementsForCommit(e){return r.a.createElement("li",{key:e.sha,className:"mx_ChangelogDialog_li"},r.a.createElement("a",{href:e.html_url,target:"_blank",rel:"noreferrer noopener"},e.commit.message.split("\n")[0]))}render(){const e=h.map((e=>{let t;return t=null==this.state[e]?r.a.createElement(d.a,{key:e}):"string"==typeof this.state[e]?Object(o.b)("Unable to load commit detail: %(msg)s",{msg:this.state[e]}):this.state[e].map(this.elementsForCommit),r.a.createElement("div",{key:e},r.a.createElement(u.a,{as:"h2",size:"4"},e),r.a.createElement("ul",null,t))})),t=r.a.createElement("div",{className:"mx_ChangelogDialog_content"},null==this.props.version||null==this.props.newVersion?r.a.createElement("h2",null,Object(o.b)("Unavailable")):e);return r.a.createElement(l.a,{title:Object(o.b)("Changelog"),description:t,button:Object(o.b)("action|update"),onFinished:this.props.onFinished})}}var g=n(74),m=n(12);const w="update";function b(e){const t=e.split("-");return 5===t.length&&"react"===t[1]&&"js"===t[3]}function y(){var e;null===(e=g.a.get())||void 0===e||e.installUpdate()}const f=(e,t,n)=>{let a,d=Object(o.b)("What's new?");n?a=()=>{m.b.createDialog(l.a,{title:Object(o.b)("What's New"),description:r.a.createElement("pre",null,n),button:Object(o.b)("action|update"),onFinished:e=>{e&&g.a.get()&&g.a.get().installUpdate()}})}:b(e)&&b(t)?a=()=>{m.b.createDialog(p,{version:e,newVersion:t,onFinished:e=>{e&&g.a.get()&&g.a.get().installUpdate()}})}:(a=y,d=Object(o.b)("action|update"));const u=i.b.get().brand;c.a.sharedInstance().addOrReplaceToast({key:w,title:Object(o.b)("Update %(brand)s",{brand:u}),props:{description:Object(o.b)("New version of %(brand)s is available",{brand:u}),acceptLabel:d,onAccept:a,rejectLabel:Object(o.b)("action|dismiss"),onReject:function(){var e;null===(e=g.a.get())||void 0===e||e.deferUpdate(t)}},component:s.a,priority:20})},v=()=>{c.a.sharedInstance().dismissToast(w)}},1509:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var a=n(652),r=n.n(a);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const s={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontWeight:"bold",isUp:!1,isLeft:!1};class c{constructor(e={}){r()(this,"browser",{ff:void 0!==window.InstallTrigger,opera:!!window.opera||navigator.userAgent.includes("Opera")}),r()(this,"params",void 0),r()(this,"canvas",void 0),r()(this,"baseImage",void 0),r()(this,"context",void 0),r()(this,"icons",void 0),r()(this,"isReady",!1),r()(this,"readyCb",void 0),this.params=i(i({},s),e),this.icons=c.getIcons(),this.canvas=document.createElement("canvas"),this.baseImage=document.createElement("img");const t=this.icons[this.icons.length-1];t.hasAttribute("href")?(this.baseImage.setAttribute("crossOrigin","anonymous"),this.baseImage.onload=()=>{this.canvas.height=this.baseImage.height>0?this.baseImage.height:32,this.canvas.width=this.baseImage.width>0?this.baseImage.width:32,this.context=this.canvas.getContext("2d"),this.ready()},this.baseImage.setAttribute("src",t.getAttribute("href"))):(this.canvas.height=this.baseImage.height=32,this.canvas.width=this.baseImage.width=32,this.context=this.canvas.getContext("2d"),this.ready())}reset(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height)}options(e,t){const n={n:"number"==typeof e?Math.abs(e):e,len:(""+e).length,x:.4,y:.4,w:.6,h:.6};return t.isUp&&(n.y<.6?n.y=n.y-.4:n.y=n.y-2*n.y+(1-n.w)),t.isLeft&&(n.x<.6?n.x=n.x-.4:n.x=n.x-2*n.x+(1-n.h)),n.x=this.canvas.width*n.x,n.y=this.canvas.height*n.y,n.w=this.canvas.width*n.w,n.h=this.canvas.height*n.h,n}circle(e,t){const n=i(i({},this.params),t),a=this.options(e,n);let r=!1;2===a.len?(a.x=a.x-.4*a.w,a.w=1.4*a.w,r=!0):a.len>=3&&(a.x=a.x-.65*a.w,a.w=1.65*a.w,r=!0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height),this.context.beginPath();const o=Math.floor(a.h*("number"==typeof a.n&&a.n>99?.85:1))+"px";if(this.context.font=`${n.fontWeight} ${o} ${n.fontFamily}`,this.context.textAlign="center",r?(this.context.moveTo(a.x+a.w/2,a.y),this.context.lineTo(a.x+a.w-a.h/2,a.y),this.context.quadraticCurveTo(a.x+a.w,a.y,a.x+a.w,a.y+a.h/2),this.context.lineTo(a.x+a.w,a.y+a.h-a.h/2),this.context.quadraticCurveTo(a.x+a.w,a.y+a.h,a.x+a.w-a.h/2,a.y+a.h),this.context.lineTo(a.x+a.h/2,a.y+a.h),this.context.quadraticCurveTo(a.x,a.y+a.h,a.x,a.y+a.h-a.h/2),this.context.lineTo(a.x,a.y+a.h/2),this.context.quadraticCurveTo(a.x,a.y,a.x+a.h/2,a.y)):this.context.arc(a.x+a.w/2,a.y+a.h/2,a.h/2,0,2*Math.PI),this.context.fillStyle=n.bgColor,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.stroke(),this.context.fillStyle=n.textColor,"number"==typeof a.n&&a.n>999){const e=(a.n>9999?9:Math.floor(a.n/1e3))+"k+";this.context.fillText(e,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.2*a.h))}else this.context.fillText(""+a.n,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.15*a.h));this.context.closePath()}ready(){var e;this.isReady||(this.isReady=!0,null===(e=this.readyCb)||void 0===e||e.call(this))}setIcon(t){e((()=>{this.setIconSrc(t.toDataURL("image/png"))}))}setIconSrc(e){if(this.browser.ff||this.browser.opera){var t;const n=this.icons[this.icons.length-1],a=window.document.createElement("link");this.icons=[a],a.setAttribute("rel","icon"),a.setAttribute("type","image/png"),window.document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("href",e),null===(t=n.parentNode)||void 0===t||t.removeChild(n)}else this.icons.forEach((t=>{t.setAttribute("href",e)}))}badge(e,t){this.isReady?("string"==typeof e||e>0?this.circle(e,t):this.reset(),this.setIcon(this.canvas)):this.readyCb=()=>{this.badge(e,t)}}static getLinks(){const e=[],t=window.document.getElementsByTagName("head")[0].getElementsByTagName("link");for(const n of t)n.hasAttribute("rel")&&/(^|\s)icon(\s|$)/i.test(n.getAttribute("rel"))&&e.push(n);return e}static getIcons(){let e=c.getLinks();return 0===e.length&&(e=[window.document.createElement("link")],e[0].setAttribute("rel","icon"),window.document.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach((e=>{e.setAttribute("type","image/png")})),e}}}).call(this,n(264).setImmediate)},400:function(e,t,n){"use strict";async function a(e=""){""===e||e.endsWith("/")||(e+="/");let t=window.location.hostname.trimEnd();"."===t[t.length-1]&&(t=t.slice(0,-1));const n=r(`${e}config.${t}.json`),a=r(e+"config.json");try{const e=await n;if(!e||0===Object.keys(e).length)throw new Error;return e}catch(e){return a}}async function r(e){const t=new URL(e,window.location.href);t.searchParams.set("cachebuster",Date.now().toString());const n=await fetch(t,{cache:"no-cache",method:"GET"});return 404===n.status||0===n.status?{}:n.ok?n.json():void 0}n.d(t,"a",(function(){return a}))}}]);
//# sourceMappingURL=init.js.map